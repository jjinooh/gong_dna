<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê³µë¬´ì› DNA í…ŒìŠ¤íŠ¸</title>
  <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
  <script>
    Kakao.init('3138aed7cfa6cb0fbdca2b0e71a77461');
  </script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #f7f9fc;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      width: 90vw;
      max-width: 420px;
      height: 90vh;
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
      text-align: center;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      box-sizing: border-box;
    }
    .container.show {
      display: flex;
    }
    h1, h2, p {
      margin-bottom: 12px;
    }
    button {
      padding: 10px 20px;
      margin: 6px;
      font-size: 15px;
      border: none;
      border-radius: 10px;
      background: #5a8dee;
      color: white;
      cursor: pointer;
      width: 80%;
      max-width: 300px;
    }
    select {
      padding: 8px;
      width: 80%;
      max-width: 300px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-bottom: 15px;
    }
    .comment {
      font-size: 12px;
      color: #888;
      margin-top: 8px;
    }
    #result img {
      width: 120px;
      height: auto;
      margin-bottom: 10px;
      border-radius: 8px;
    }
    #resultText {
      white-space: pre-wrap;
      margin-bottom: 20px;
      font-size: 16px;
      font-weight: bold;
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <div class="container show" id="userinfo">
    <h2>ê³µì§ ê²½ë ¥ ì²´í¬</h2>
    <p>ë‹¹ì‹ ì˜ ê³µì§ ì—°ì°¨ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”!</p>
    <select id="experience">
      <option value="1ë…„ ë¯¸ë§Œ">ğŸ¼ 1ë…„ ë¯¸ë§Œ</option>
      <option value="1~3ë…„">ğŸŒ± 1~3ë…„</option>
      <option value="4~7ë…„">ğŸŒ³ 4~7ë…„</option>
      <option value="8ë…„ ì´ìƒ">ğŸ§˜ 8ë…„ ì´ìƒ</option>
    </select>
    <button onclick="saveUserInfo()">í…ŒìŠ¤íŠ¸ ì‹œì‘í•˜ê¸°</button>
  </div>

  <div class="container" id="intro">
    <h1>ê³µë¬´ì› DNA í…ŒìŠ¤íŠ¸ ğŸ§¬</h1>
    <p>ë‚˜ëŠ” ê³µë¬´ì›ì„ ê³„ì†í•  ìƒì¸ê°€?</p>
    <button onclick="startTest()">ì‹œì‘!</button>
    <div class="comment">* ë³¸ í…ŒìŠ¤íŠ¸ëŠ” ì¬ë¯¸ìš©ì…ë‹ˆë‹¤ :)</div>
  </div>

  <div id="questions"></div>

  <div class="container" id="result">
    <h2>ğŸ¯ ë‹¹ì‹ ì˜ ê²°ê³¼ëŠ”?</h2>
    <img id="resultImage" src="" alt="ê²°ê³¼ ì´ë¯¸ì§€">
    <p id="resultText"></p>
    <button onclick="copyResult()">ğŸ”— ê²°ê³¼ ë³µì‚¬</button>
    <button onclick="shareKakao()">ğŸ’¬ ì¹´ì¹´ì˜¤í†¡ ê³µìœ </button>
    <button onclick="location.reload()">ğŸ” ë‹¤ì‹œ í•˜ê¸°</button>
    <div class="comment" style="margin-top: 20px; font-size: 13px; color: #999;">
      Made by <strong>JINO</strong><br>
      #ì¶œê·¼ê³ ë¯¼ë§Œ100ë²ˆì§¸ #ë‚´ë©´ë¶„íˆ¬í˜•
    </div>
  </div>

<script>
function saveUserInfo() {
  const exp = document.getElementById('experience').value;
  userInfo = { experience: exp };

  // q2 ì§ˆë¬¸ ì£¼ì… (baseQuestions[2]ì— ë°˜ì˜)
  const q2Data = q2Map[exp];
  if (q2Data) {
    baseQuestions[2] = {
      text: q2Data.text,
      options: q2Data.options // ì´ë¯¸ {text, score} êµ¬ì¡°ì´ë¯€ë¡œ ê°€ê³µ ë¶ˆí•„ìš”
    };
  } else {
    console.error("í•´ë‹¹ ì—°ì°¨ì— ëŒ€í•œ q2Map ë°ì´í„° ì—†ìŒ:", exp);
  }

  document.getElementById('userinfo').classList.remove('show');
  document.getElementById('intro').classList.add('show');
}
function showNextQuestion() {
  const qWrap = document.getElementById('questions');
  qWrap.innerHTML = '';

  if (currentQuestion >= baseQuestions.length) {
    showResult();
    return;
  }

  let currentQData = baseQuestions[currentQuestion];
  let finalQ = currentQData;

  if (currentQData.branch) {
    const exp = userInfo.experience;
    const branchKey = currentQData.key;
    const branchSet = branchKey === 'branchQuestions' ? branchQuestions[exp]
                    : branchKey === 'branchQuestions2' ? branchQuestions2[exp]
                    : null;

    if (branchSet && branchSet.length > 0) {
      finalQ = branchSet.shift();
    } else {
      currentQuestion++;
      showNextQuestion();
      return;
    }
  }

  const qDiv = document.createElement('div');
  qDiv.className = 'container show';

  const qTitle = document.createElement('p');
  qTitle.innerHTML = `<strong>Q${currentQuestion + 1}.</strong> ${finalQ.text}`;
  qDiv.appendChild(qTitle);

  finalQ.options.forEach(opt => {
    const btn = document.createElement('button');
    btn.innerText = opt.text;
    btn.onclick = () => {
      answers.push(opt); // {text, score}
      currentQuestion++;
      qDiv.remove();
      showNextQuestion();
    };
    qDiv.appendChild(btn);
  });

  qWrap.appendChild(qDiv);
}
function showResult() {
  document.getElementById('questions').innerHTML = '';
  document.getElementById('result').classList.add('show');

  let totalScore = 0;
  answers.forEach(answer => {
    if (typeof answer === 'object' && 'score' in answer) {
      totalScore += answer.score;
    }
  });

  const result = resultTypes.find(r => r.condition(totalScore));

  document.getElementById('resultImage').src = imageMap[result.name];
  document.getElementById('resultText').innerText = `${result.name}\n${result.desc}`;
}
function shareKakao() {
  const resultTextElement = document.getElementById('resultText');
  if (!resultTextElement) return;

  const fullResultText = resultTextElement.innerText;
  const resultName = fullResultText.split('\n')[0];
  const resultDesc = fullResultText.split('\n').slice(1).join('\n');
  const resultImage = document.getElementById('resultImage').src;
  const currentUrl = window.location.href.split('?')[0];

  Kakao.Link.sendDefault({
    objectType: 'feed',
    content: {
      title: 'ë‚˜ëŠ” ê³µë¬´ì›ì„ ê³„ì†í•  ìƒì¸ê°€?',
      description: `í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${resultName}\n${resultDesc}`,
      imageUrl: resultImage,
      link: {
        mobileWebUrl: currentUrl,
        webUrl: currentUrl
      }
    },
    buttons: [
      {
        title: 'í…ŒìŠ¤íŠ¸ í•´ë³´ê¸°',
        link: {
          mobileWebUrl: currentUrl,
          webUrl: currentUrl
        }
      }
    ]
  });
}

</script>
</body>
</html>
